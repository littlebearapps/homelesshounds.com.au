---
import Base from "../../../../layouts/Base.astro";
import AdoptionModal from "../../../../components/AdoptionModal.astro";
import CTASection from "../../../../components/CTASection.astro";
import type { AnimalDetailResponse } from "../../../../types/asm";
import { createAnimalProfile, getCompatibilityIcon, calculateAge } from "../../../../types/asm";

export async function getStaticPaths() {
  // For static generation, we'll need to fetch all animals
  // In a real implementation, this would be populated during build
  // For now, return empty array - these will be handled dynamically
  return [];
}

const { species, id, slug } = Astro.params;

// Validate parameters
if (!species || !id || !slug) {
  return Astro.redirect("/adopt");
}

if (!['dog', 'cat'].includes(species)) {
  return Astro.redirect("/adopt");
}

// Fetch animal details
let animalData: AnimalDetailResponse | null = null;
let error: string | null = null;

try {
  const response = await fetch(`${Astro.url.origin}/api/asm/animal/${id}`);
  if (!response.ok) {
    throw new Error(`API returned ${response.status}`);
  }
  animalData = await response.json();
} catch (e) {
  console.error('Error fetching animal details:', e);
  error = e instanceof Error ? e.message : 'Failed to fetch animal details';
}

const animal = animalData?.animal;
const images = animalData?.images || [];

// Check if animal exists and is the correct species
if (!animal) {
  return Astro.redirect("/adopt");
}

if (animal.SPECIESNAME.toLowerCase() !== species) {
  return Astro.redirect("/adopt");
}

// Create structured profile
const profile = createAnimalProfile(animal);

// Create page title and meta description with enhanced info
const title = `${animal.ANIMALNAME} - ${animal.BREEDNAME} ${animal.SPECIESNAME} for Adoption`;
const description = `Meet ${animal.ANIMALNAME}, a ${animal.AGEGROUP.toLowerCase()} ${animal.SEXNAME.toLowerCase()} ${animal.BREEDNAME} ${animal.SPECIESNAME.toLowerCase()} looking for a loving home. ${animal.SIZENAME} size, ${animal.DAYSONSHELTER} days in care.${profile.adoption.fee ? ` Adoption fee: $${profile.adoption.fee}.` : ''}`;

// Main image URL
const mainImageUrl = animalData?.thumbnailUrl || `https://service.sheltermanager.com/asmservice?account=st3418&method=animal_thumbnail&animalid=${animal.ID}`;

// Calculate days on shelter for display
const daysText = animal.DAYSONSHELTER === 1 ? '1 day' : `${animal.DAYSONSHELTER} days`;

// Format entry date
const entryDate = animal.DATEBROUGHTIN ? new Date(animal.DATEBROUGHTIN).toLocaleDateString('en-AU', {
  day: 'numeric',
  month: 'short',
  year: 'numeric'
}) : null;

// Get coat type if available
const coatType = animal.COATTYPENAME || null;

// Determine icon for species
const speciesIcon = species === 'dog' ? 'üêï' : 'üê±';
const heroColor = species === 'dog' ? 'from-blue-500 to-blue-700' : 'from-amber-500 to-amber-700';
const accentColor = species === 'dog' ? 'blue' : 'amber';

// Enhanced compatibility information
const compatibilityInfo = [
  {
    label: 'üê± Good with Cats',
    level: profile.compatibility.cats,
    icon: getCompatibilityIcon(profile.compatibility.cats, 'cats'),
    show: true
  },
  {
    label: 'üêï Good with Dogs',
    level: profile.compatibility.dogs,
    icon: getCompatibilityIcon(profile.compatibility.dogs, 'dogs'),
    show: true
  },
  {
    label: 'üë∂ Good with Children',
    level: profile.compatibility.children,
    icon: getCompatibilityIcon(profile.compatibility.children, 'children'),
    show: true
  },
  {
    label: 'üê∞ Good with Small Animals',
    level: profile.compatibility.smallAnimals,
    icon: getCompatibilityIcon(profile.compatibility.smallAnimals, 'small'),
    show: animal.ISGOODWITHSMALLANIMALS !== undefined
  },
  {
    label: 'üè† House Trained',
    level: profile.compatibility.houseTrained,
    icon: getCompatibilityIcon(profile.compatibility.houseTrained, 'house'),
    show: true
  },
].filter(item => item.show);
---

<Base title={title} description={description}>
  <!-- Open Graph and Twitter meta tags -->
  <meta property="og:title" content={title} />
  <meta property="og:description" content={description} />
  <meta property="og:image" content={mainImageUrl} />
  <meta property="og:type" content="article" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content={title} />
  <meta name="twitter:description" content={description} />
  <meta name="twitter:image" content={mainImageUrl} />

  <!-- Enhanced Structured Data for SEO -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "Animal",
    "name": animal.ANIMALNAME,
    "species": animal.SPECIESNAME,
    "breed": animal.BREEDNAME,
    "gender": animal.SEXNAME,
    "age": animal.AGEGROUP,
    "size": animal.SIZENAME,
    "weight": animal.WEIGHT ? `${animal.WEIGHT}kg` : undefined,
    "description": animal.ANIMALCOMMENTS || `${animal.ANIMALNAME} is a ${animal.AGEGROUP.toLowerCase()} ${animal.SEXNAME.toLowerCase()} ${animal.BREEDNAME} ${animal.SPECIESNAME.toLowerCase()} looking for adoption.`,
    "image": mainImageUrl,
    "url": Astro.url.href,
    "isAvailableForAdoption": animal.HASACTIVERESERVE !== 1,
    "healthCondition": profile.medical.healthNotes || "Good health",
    "adoptionFee": profile.adoption.fee ? `$${profile.adoption.fee}` : undefined,
    "location": profile.adoption.location,
    "shelter": {
      "@type": "Organization",
      "name": "Homeless Hounds Animal Rescue",
      "url": Astro.site
    },
    "additionalProperty": [
      ...(animal.NEUTERED === 1 ? [{ "@type": "PropertyValue", "name": "Desexed", "value": "Yes" }] : []),
      ...(animal.IDENTICHIPPED === 1 || animal.MICROCHIPPED === 1 ? [{ "@type": "PropertyValue", "name": "Microchipped", "value": "Yes" }] : []),
      ...(animal.ISGOODWITHCATS === 1 ? [{ "@type": "PropertyValue", "name": "Good with Cats", "value": "Yes" }] : []),
      ...(animal.ISGOODWITHDOGS === 1 ? [{ "@type": "PropertyValue", "name": "Good with Dogs", "value": "Yes" }] : []),
      ...(animal.ISGOODWITHCHILDREN === 1 ? [{ "@type": "PropertyValue", "name": "Good with Children", "value": "Yes" }] : []),
      ...(profile.medical.vaccinationCount ? [{ "@type": "PropertyValue", "name": "Vaccination Count", "value": profile.medical.vaccinationCount.toString() }] : [])
    ].filter(Boolean)
  })} />

  <!-- Hero Section -->
  <section class={`relative isolate overflow-hidden bg-white min-h-[40vh] flex items-center`}>
    <div class="absolute inset-0 -z-10">
      <div class={`absolute inset-0 bg-gradient-to-br ${heroColor}`}></div>
    </div>
    <div class="absolute inset-0 bg-pattern-dots opacity-10"></div>

    <div class="container-custom py-16 md:py-20 relative z-10">
      <div class="max-w-4xl mx-auto text-center">
        <!-- Breadcrumb -->
        <nav class="flex justify-center items-center space-x-2 text-sm text-white/80 mb-6">
          <a href="/adopt" class="hover:text-white transition-colors">All Animals</a>
          <span>‚Ä∫</span>
          <a href={`/adopt/${species}s`} class="hover:text-white transition-colors">
            {species === 'dog' ? 'Dogs' : 'Cats'}
          </a>
          <span>‚Ä∫</span>
          <span class="text-white font-medium">{animal.ANIMALNAME}</span>
        </nav>

        <!-- Name and Breed -->
        <h1 class="text-white mb-4 text-4xl md:text-6xl font-bold">
          {animal.ANIMALNAME}
        </h1>
        <p class="text-xl md:text-2xl text-white/90 mb-8">
          {animal.BREEDNAME} {animal.SPECIESNAME}
          {animal.CROSSBREED === 1 && (
            <span class="ml-2 text-sm bg-white/20 text-white px-3 py-1 rounded-full">Mix</span>
          )}
        </p>

        <!-- Reserved Status -->
        {animal.HASACTIVERESERVE === 1 && (
          <div class="inline-flex items-center bg-red-500 text-white px-6 py-3 rounded-full font-bold uppercase tracking-wider shadow-lg transform rotate-2 mb-6">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
            </svg>
            Currently Reserved
          </div>
        )}

        <!-- Key Info Pills -->
        <div class="flex flex-wrap gap-3 justify-center">
          <span class="bg-white/20 backdrop-blur text-white px-4 py-2 rounded-full font-medium">
            {animal.AGEGROUP}
          </span>
          <span class="bg-white/20 backdrop-blur text-white px-4 py-2 rounded-full font-medium">
            {animal.SEXNAME}
          </span>
          <span class="bg-white/20 backdrop-blur text-white px-4 py-2 rounded-full font-medium">
            {animal.SIZENAME} Size
          </span>
          {profile.basicInfo.weight && (
            <span class="bg-white/20 backdrop-blur text-white px-4 py-2 rounded-full font-medium">
              {profile.basicInfo.weight}kg
            </span>
          )}
          <span class="bg-white/20 backdrop-blur text-white px-4 py-2 rounded-full font-medium">
            In care {daysText}
          </span>
        </div>
      </div>
    </div>
  </section>

  <!-- Main Content -->
  <div class="container-custom py-12">

    <!-- Error State -->
    {error && (
      <div class="text-center py-16">
        <div class="bg-red-50 border-2 border-red-200 rounded-xl p-8 max-w-lg mx-auto">
          <h3 class="text-lg font-semibold text-red-800 mb-2">Unable to Load Animal Details</h3>
          <p class="text-red-700 text-sm mb-4">We're having trouble loading information about this animal.</p>
          <a href="/adopt" class="inline-flex items-center px-4 py-2 bg-red-100 hover:bg-red-200 text-red-800 rounded-lg font-medium transition-colors">
            ‚Üê Back to All Animals
          </a>
        </div>
      </div>
    )}

    <!-- Animal Details -->
    {animal && (
      <div>
        <!-- Image Gallery Section -->
        <div class="mb-16">
          <div class="grid lg:grid-cols-3 gap-8">
            <!-- Main Image -->
            <div class="lg:col-span-2">
              <div class="relative overflow-hidden rounded-2xl shadow-lg group">
                {profile.media.imageCount > 0 && (
                  <div class="absolute top-4 left-4 z-10">
                    <span class="bg-black/70 backdrop-blur text-white px-3 py-1.5 rounded-full text-sm font-medium">
                      üì∏ {profile.media.imageCount} {profile.media.imageCount === 1 ? 'photo' : 'photos'}
                    </span>
                  </div>
                )}

                <img
                  src={mainImageUrl}
                  alt={`${animal.ANIMALNAME} - ${animal.BREEDNAME} ${animal.SPECIESNAME}`}
                  class="w-full h-[500px] object-cover"
                  loading="eager"
                />
              </div>

              <!-- Thumbnail Gallery -->
              {images.length > 0 && (
                <div class="mt-4">
                  <div class="grid grid-cols-6 gap-2">
                    {images.map((imageUrl, index) => (
                      <div class="relative group cursor-pointer">
                        <img
                          src={imageUrl}
                          alt={`${animal.ANIMALNAME} photo ${index + 1}`}
                          class={`w-full h-20 object-cover rounded-lg transition-all duration-300 ${index === 0 ? 'ring-2 ring-' + accentColor + '-500' : 'hover:opacity-75'}`}
                        />
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>

            <!-- Quick Info Card -->
            <div class="lg:col-span-1">
              <div class="bg-white rounded-2xl shadow-lg p-6 sticky top-24">
                <h3 class="text-xl font-bold text-gray-900 mb-4">Quick Info</h3>

                <!-- Adoption Fee -->
                <div class={`bg-gradient-to-r from-${accentColor}-50 to-pink-50 rounded-xl p-4 mb-4`}>
                  <div class="flex items-center justify-between">
                    <span class="text-gray-700 font-medium">Adoption Fee</span>
                    <span class={`text-2xl font-bold text-${accentColor}-700`}>
                      {profile.adoption.fee ? `$${profile.adoption.fee}` : 'Contact us'}
                    </span>
                  </div>
                  <p class="text-xs text-gray-600 mt-1">
                    {profile.adoption.fee ? 'Includes all medical care' : 'Please enquire for details'}
                  </p>
                </div>

                <!-- Location -->
                <div class="flex items-center justify-between py-3 border-b border-gray-100">
                  <span class="text-gray-600">üìç Location</span>
                  <span class="font-medium text-gray-900">
                    {profile.adoption.location || animal.SHELTERLOCATIONNAME || 'Contact for details'}
                  </span>
                </div>

                <!-- ID Number -->
                <div class="flex items-center justify-between py-3 border-b border-gray-100">
                  <span class="text-gray-600">üè∑Ô∏è ID</span>
                  <span class="font-medium text-gray-900">#{animal.ID}</span>
                </div>

                <!-- Days in Care -->
                <div class="flex items-center justify-between py-3 border-b border-gray-100">
                  <span class="text-gray-600">üìÖ Time with us</span>
                  <span class="font-medium text-gray-900">{daysText}</span>
                </div>

                {/* Entry Date */}
                {entryDate && (
                  <div class="flex items-center justify-between py-3 border-b border-gray-100">
                    <span class="text-gray-600">üìÜ Arrived</span>
                    <span class="font-medium text-gray-900">{entryDate}</span>
                  </div>
                )}

                {/* Entry Reason */}
                {animal.ENTRYREASONNAME && (
                  <div class="flex items-center justify-between py-3 border-b border-gray-100">
                    <span class="text-gray-600">üìù Entry reason</span>
                    <span class="font-medium text-gray-900 text-sm">{animal.ENTRYREASONNAME}</span>
                  </div>
                )}

                <!-- CTA Buttons -->
                <div class="mt-6 space-y-3">
                  {animal.HASACTIVERESERVE !== 1 ? (
                    <button
                      id="apply-adopt-btn"
                      class="w-full inline-flex items-center justify-center px-6 py-3 bg-orange-600 text-white rounded-xl hover:bg-orange-700 font-semibold transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5"
                    >
                      <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 420 404">
                        <path d="m281.78 0c-0.88 0.011256-1.79 0.054519-2.69 0.125-35.82 6.1835-55.52 44.064-58.37 77.469-4.17 30.316 9.19 69.266 42.47 76.066 4.83 0.92 9.84 0.5 14.56-0.78 40.08-13.44 58.01-60.908 52.22-100.22-1.69-25.396-20.83-53.009-48.19-52.66zm-151.87 1.625c-22.28 0.5468-39.63 23.138-43.16 44.375-7.441 42.074 11.698 94.35 55.53 107.66 4.11 0.89 8.35 0.98 12.5 0.34 29.63-4.94 42.18-38.15 40.94-64.969-0.89-35.372-19.27-76.273-56-86.218-3.36-0.8909-6.63-1.2661-9.81-1.188zm248.93 119.5c-38.53 2.31-64.95 40.76-68.72 76.66-5.09 25.89 8.71 60.53 38.26 62.6 41.19-0.51 69.3-44.53 70.46-82.41 2.61-25.05-12.15-55.46-40-56.85zm-337.28 8.54c-16.394-0.14-32.517 9.68-37.874 26.34-14.293 44.58 14.408 101.04 61.624 110.41 19.706 3.37 37.018-11.76 41.908-29.97 10.35-38.95-10.915-84.17-46.908-101.85-5.863-3.29-12.334-4.88-18.75-4.93zm172.75 79.93c-32.14 0.07-64.78 16.38-85.59 40.66-22.48 28.3-40.892 61.23-48.095 96.94-8.751 25.7 11.083 55.29 38.565 55.47 33.06 0.91 61.47-21.79 94.34-23.47 27.89-4.25 52.86 10.25 77.94 19.75 21.35 9.13 50.85 5.63 61.75-17.35 8.57-23.41-4.05-48.39-14.5-69.18-21.32-33.76-44.17-69.24-79.13-90.32-14.01-8.68-29.58-12.53-45.28-12.5z" />
                      </svg>
                      Apply to Adopt {animal.ANIMALNAME}
                    </button>
                  ) : (
                    <div class="w-full inline-flex items-center justify-center px-6 py-3 bg-gray-400 text-white rounded-xl cursor-not-allowed opacity-75">
                      <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                      </svg>
                      Currently Reserved
                    </div>
                  )}
                  <a
                    href="/contact-us"
                    class="w-full inline-flex items-center justify-center px-6 py-3 bg-white text-gray-700 border-2 border-gray-300 rounded-xl hover:bg-gray-50 font-medium transition-colors"
                  >
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4-8 9-8s9 3.582 9 8z" />
                    </svg>
                    Ask a Question
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- About Section - Full Width -->
        <div class="mb-16">
          <div class="max-w-4xl mx-auto text-center">
            <h2 class="text-3xl font-bold text-gray-900 mb-8">About {animal.ANIMALNAME}</h2>
            <div class="bg-gray-50 rounded-2xl p-8 shadow-md">
              <div class="prose prose-lg max-w-none text-gray-700 leading-relaxed whitespace-pre-line">
                {animal.ANIMALCOMMENTS || animal.WEBSITEMEDIANOTES ||
                  `${animal.ANIMALNAME} is a ${animal.AGEGROUP.toLowerCase()} ${animal.SEXNAME.toLowerCase()} ${animal.BREEDNAME} looking for a loving home. ${animal.HASSPECIALNEEDS === 1 ? 'This pet has special needs and requires an understanding family. ' : ''}Please contact us to learn more about this wonderful ${animal.SPECIESNAME.toLowerCase()}.`
                }
              </div>
            </div>
          </div>
        </div>

        <!-- Key Information Cards -->
        <div class="mb-16">
          <h2 class="text-2xl font-bold text-gray-900 mb-8 text-center">Key Information</h2>
          <div class="grid md:grid-cols-3 gap-6">
            <!-- Compatibility Card -->
            <div class="bg-white rounded-2xl shadow-md p-6">
              <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                <span class="text-2xl mr-2">ü§ù</span>
                Compatibility
              </h3>
              {compatibilityInfo.length > 0 ? (
                <div class="space-y-3">
                  {compatibilityInfo.map(item => (
                    <div class="flex items-center justify-between bg-gray-50 rounded-lg p-3">
                      <span class="text-gray-600">{item.label}</span>
                      <span class="font-medium text-gray-900">{item.icon}</span>
                    </div>
                  ))}
                </div>
              ) : (
                <p class="text-sm text-gray-500 italic">Compatibility information not yet available</p>
              )}
            </div>

            <!-- Health Card -->
            <div class="bg-white rounded-2xl shadow-md p-6">
              <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                <span class="text-2xl mr-2">üè•</span>
                Health Status
              </h3>
              {(profile.medical.isNeutered || profile.medical.isMicrochipped ||
                (profile.medical.vaccinationCount && profile.medical.vaccinationCount > 0) ||
                profile.medical.hasSpecialNeeds || animal.HEARTWORMTESTED === 1 ||
                (animal.COMBITESTED === 1 && animal.SPECIESNAME === 'Cat') ||
                (animal.DECLAWED === 1 && animal.SPECIESNAME === 'Cat')) ? (
                <div class="space-y-3">
                  {profile.medical.isNeutered ? (
                    <div class="flex items-center text-green-700 bg-green-50 rounded-lg p-3">
                      <span class="text-green-600 mr-2">‚úÖ</span>
                      <span class="font-medium text-gray-900">Desexed</span>
                    </div>
                  ) : null}
                  {profile.medical.isMicrochipped ? (
                    <div class="flex items-center text-green-700 bg-green-50 rounded-lg p-3">
                      <span class="text-green-600 mr-2">‚úÖ</span>
                      <span class="font-medium text-gray-900">Microchipped</span>
                    </div>
                  ) : null}
                  {profile.medical.vaccinationCount && profile.medical.vaccinationCount > 0 ? (
                    <div class="flex items-center text-green-700 bg-green-50 rounded-lg p-3">
                      <span class="text-green-600 mr-2">üíâ</span>
                      <span class="font-medium text-gray-900">{profile.medical.vaccinationCount}x Vaccinated</span>
                    </div>
                  ) : null}
                  {profile.medical.hasSpecialNeeds ? (
                    <div class="flex items-center text-orange-700 bg-orange-50 rounded-lg p-3">
                      <span class="text-orange-600 mr-2">üíñ</span>
                      <span class="font-medium text-gray-900">Special Needs</span>
                    </div>
                  ) : null}
                  {animal.HEARTWORMTESTED === 1 ? (
                    <div class="flex items-center text-green-700 bg-green-50 rounded-lg p-3">
                      <span class="text-green-600 mr-2">üî¨</span>
                      <span class="font-medium text-gray-900">
                        Heartworm {animal.HEARTWORMTESTRESULTNAME === 'Negative' ? 'Negative' :
                                  animal.HEARTWORMTESTRESULTNAME === 'Positive' ? 'Positive' : 'Tested'}
                      </span>
                    </div>
                  ) : null}
                  {animal.COMBITESTED === 1 && animal.SPECIESNAME === 'Cat' ? (
                    <div class="flex items-center text-green-700 bg-green-50 rounded-lg p-3">
                      <span class="text-green-600 mr-2">üî¨</span>
                      <span class="font-medium text-gray-900">
                        FIV/FeLV {animal.FLVRESULTNAME === 'Negative' ? 'Negative' :
                                 animal.FLVRESULTNAME === 'Positive' ? 'Positive' : 'Tested'}
                      </span>
                    </div>
                  ) : null}
                  {animal.DECLAWED === 1 && animal.SPECIESNAME === 'Cat' ? (
                    <div class="flex items-center text-blue-700 bg-blue-50 rounded-lg p-3">
                      <span class="text-blue-600 mr-2">‚ÑπÔ∏è</span>
                      <span class="font-medium text-gray-900">Declawed</span>
                    </div>
                  ) : null}
                </div>
              ) : (
                <p class="text-sm text-gray-500 italic">Health information being updated</p>
              )}
            </div>

            <!-- Details Card -->
            <div class="bg-white rounded-2xl shadow-md p-6">
              <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                <span class="text-2xl mr-2">üìã</span>
                Details
              </h3>
              <div class="space-y-3">
                <div class="flex justify-between items-center py-2 border-b border-gray-100">
                  <span class="text-gray-600 text-sm">Age</span>
                  <span class="font-medium text-gray-900">{animal.AGEGROUP}</span>
                </div>
                <div class="flex justify-between items-center py-2 border-b border-gray-100">
                  <span class="text-gray-600 text-sm">Sex</span>
                  <span class="font-medium text-gray-900">{animal.SEXNAME}</span>
                </div>
                <div class="flex justify-between items-center py-2 border-b border-gray-100">
                  <span class="text-gray-600 text-sm">Size</span>
                  <span class="font-medium text-gray-900">{animal.SIZENAME}</span>
                </div>
                {profile.basicInfo.weight && (
                  <div class="flex justify-between items-center py-2 border-b border-gray-100">
                    <span class="text-gray-600 text-sm">Weight</span>
                    <span class="font-medium text-gray-900">{profile.basicInfo.weight}kg</span>
                  </div>
                )}
                <div class="flex justify-between items-center py-2 border-b border-gray-100">
                  <span class="text-gray-600 text-sm">Breed</span>
                  <span class="font-medium text-gray-900 text-right">
                    {animal.BREEDNAME}
                    {animal.CROSSBREED === 1 && ' Mix'}
                  </span>
                </div>
                {coatType && (
                  <div class="flex justify-between items-center py-2">
                    <span class="text-gray-600 text-sm">Coat</span>
                    <span class="font-medium text-gray-900">{coatType}</span>
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>

        <!-- Medical Notes -->
        {profile.medical.healthNotes && (
          <div class="mb-16 max-w-4xl mx-auto">
            <div class="bg-blue-50 border-l-4 border-blue-500 rounded-xl p-6">
              <h3 class="text-lg font-bold text-blue-900 mb-3 flex items-center">
                <svg class="w-5 w-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                </svg>
                Medical Notes
              </h3>
              <p class="text-blue-800 whitespace-pre-line">{profile.medical.healthNotes}</p>
            </div>
          </div>
        )}

        <!-- Physical Description -->
        {animal.MARKINGS && (
          <div class="mb-16 max-w-4xl mx-auto">
            <div class={`bg-${accentColor}-50 rounded-2xl p-6`}>
              <h3 class={`text-lg font-bold text-${accentColor}-900 mb-3 flex items-center`}>
                <span class="text-2xl mr-2">üé®</span>
                Physical Description
              </h3>
              <p class={`text-${accentColor}-800`}>{animal.MARKINGS}</p>
            </div>
          </div>
        )}

        <!-- Final CTA Section -->
        <div class="mb-16">
          <div class={`bg-gradient-to-br from-${accentColor}-50 to-pink-50 rounded-3xl p-12 text-center`}>
            <h2 class="text-3xl font-bold text-gray-900 mb-4">
              Ready to Welcome {animal.ANIMALNAME} Home?
            </h2>
            <p class="text-lg text-gray-700 mb-8 max-w-2xl mx-auto">
              {animal.ANIMALNAME} is waiting to meet their forever family. Start your adoption journey today and give this beautiful {animal.SPECIESNAME.toLowerCase()} the loving home they deserve.
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
              {animal.HASACTIVERESERVE !== 1 ? (
                <button
                  id="apply-adopt-btn-bottom"
                  class="inline-flex items-center justify-center px-8 py-4 bg-orange-600 text-white rounded-xl hover:bg-orange-700 font-semibold text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-1"
                >
                  <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 420 404">
                    <path d="m281.78 0c-0.88 0.011256-1.79 0.054519-2.69 0.125-35.82 6.1835-55.52 44.064-58.37 77.469-4.17 30.316 9.19 69.266 42.47 76.066 4.83 0.92 9.84 0.5 14.56-0.78 40.08-13.44 58.01-60.908 52.22-100.22-1.69-25.396-20.83-53.009-48.19-52.66zm-151.87 1.625c-22.28 0.5468-39.63 23.138-43.16 44.375-7.441 42.074 11.698 94.35 55.53 107.66 4.11 0.89 8.35 0.98 12.5 0.34 29.63-4.94 42.18-38.15 40.94-64.969-0.89-35.372-19.27-76.273-56-86.218-3.36-0.8909-6.63-1.2661-9.81-1.188zm248.93 119.5c-38.53 2.31-64.95 40.76-68.72 76.66-5.09 25.89 8.71 60.53 38.26 62.6 41.19-0.51 69.3-44.53 70.46-82.41 2.61-25.05-12.15-55.46-40-56.85zm-337.28 8.54c-16.394-0.14-32.517 9.68-37.874 26.34-14.293 44.58 14.408 101.04 61.624 110.41 19.706 3.37 37.018-11.76 41.908-29.97 10.35-38.95-10.915-84.17-46.908-101.85-5.863-3.29-12.334-4.88-18.75-4.93zm172.75 79.93c-32.14 0.07-64.78 16.38-85.59 40.66-22.48 28.3-40.892 61.23-48.095 96.94-8.751 25.7 11.083 55.29 38.565 55.47 33.06 0.91 61.47-21.79 94.34-23.47 27.89-4.25 52.86 10.25 77.94 19.75 21.35 9.13 50.85 5.63 61.75-17.35 8.57-23.41-4.05-48.39-14.5-69.18-21.32-33.76-44.17-69.24-79.13-90.32-14.01-8.68-29.58-12.53-45.28-12.5z" />
                  </svg>
                  Apply to Adopt {animal.ANIMALNAME}
                </button>
              ) : (
                <div class="inline-flex items-center px-8 py-4 bg-gray-400 text-white rounded-xl cursor-not-allowed opacity-75">
                  <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                  </svg>
                  Currently Reserved
                </div>
              )}
              <a
                href={`/adopt/${species}s`}
                class="inline-flex items-center justify-center px-8 py-4 bg-white text-gray-700 border-2 border-gray-300 rounded-xl hover:bg-gray-50 font-medium text-lg transition-colors"
              >
                View More {species === 'dog' ? 'Dogs' : 'Cats'}
                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              </a>
            </div>
          </div>
        </div>
      </div>
    )}
  </div>

  <!-- CTA Section -->
  <CTASection />

  <!-- Adoption Modal -->
  {animal && animal.HASACTIVERESERVE !== 1 && (
    <AdoptionModal
      petId={animal.ID}
      petName={animal.ANIMALNAME}
      petBreed={animal.BREEDNAME}
      petSpecies={animal.SPECIESNAME}
      petAge={animal.AGEGROUP}
      petSex={animal.SEXNAME}
      petSize={animal.SIZENAME}
    />
  )}

  <!-- Script for modal triggers -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const buttons = document.querySelectorAll('#apply-adopt-btn, #apply-adopt-btn-bottom');
      buttons.forEach(btn => {
        btn?.addEventListener('click', () => {
          const event = new CustomEvent('openAdoptionModal');
          window.dispatchEvent(event);
        });
      });
    });
  </script>
</Base>